
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Developer Guide &#8212; Open Ephys Documentation 0.0.0 documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/copyURLToClipboard.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="SPI Commutator" href="../../spi-commutator/index.html" />
    <link rel="prev" title="Troubleshooting" href="../user-guide/troubleshooting.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../index.html">
  <img src="../../_static/oe_logo_name.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../index.html">
  Coax Commutator
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../spi-commutator/index.html">
  SPI Commutator
 </a>
</li>

    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://open-ephys.org">Open Ephys<i class="fas fa-external-link-alt"></i></a>
    </li>
    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/open-ephys/commutator-docs" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/openephys" rel="noopener" target="_blank" title="Twitter"><span><i class="fab fa-twitter"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://discord.gg/WXAx2URNQU" rel="noopener" target="_blank" title="Discord"><span><i class="fab fa-discord"></i></span>
            <label class="sr-only">Discord</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../quick-start-guide/index.html">
   Quick Start
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../user-guide/index.html">
   User Guide
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../user-guide/mount-connect.html">
     Mounting and Connecting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../user-guide/status-led.html">
     Status LED
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../user-guide/manual-control.html">
     Manual Control
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../user-guide/remote-control.html">
     Remote Control
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../user-guide/saving-settings.html">
     Saving Settings
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../user-guide/automatic-control/index.html">
     Automating Commutation
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../user-guide/automatic-control/onix-coaxheadstage64.html">
       ONIX and Coaxial Headstage-64
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../user-guide/automatic-control/onix-miniscopev4.html">
       ONIX and UCLA Miniscope v4
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../user-guide/automatic-control/onix-computervision.html">
       ONIX and Computer Vision
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../user-guide/automatic-control/miniscopedaq-miniscopev4.html">
       Miniscope DAQ and UCLA Miniscope v4
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../user-guide/troubleshooting.html">
     Troubleshooting
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="current reference internal" href="#">
   Developer Guide
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="simple">
  </ul>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#design-files">
   Design Files
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bill-of-materials-bom">
   Bill of Materials (BoM)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ordering-and-manufacturing-parts">
   Ordering and Manufacturing Parts
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mechanical">
     Mechanical
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#electrical">
     Electrical
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#teensy-and-programming-an-open-ephys-commutator">
   Teensy and Programming an Open Ephys Commutator
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#assembly">
   Assembly
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="developer-guide">
<span id="dev-guide"></span><h1>Developer Guide<a class="headerlink" href="#developer-guide" title="Permalink to this headline">#</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For an overview of Open Ephys Commutators, visit the <a class="reference internal" href="../../index.html#oec"><span class="std std-ref">Open Ephys Commutators</span></a>.  For
instructions on how to use the Coaxial Commutator, visit the Coaxial Commutator
<a class="reference internal" href="../quick-start-guide/index.html#quick-start"><span class="std std-ref">Quick Start</span></a> Guide and <a class="reference internal" href="../user-guide/index.html#user-guide"><span class="std std-ref">User Guide</span></a>.</p>
</div>
<section id="design-files">
<h2>Design Files<a class="headerlink" href="#design-files" title="Permalink to this headline">#</a></h2>
<p>Open Ephys commutators are open-source. Mechanical, electrical, and firmware designs are available in the
<a class="reference external" href="https://github.com/open-ephys/onix-commutator">onix-commutator git repo</a>. Below explains how to manufacture
your own Open Ephys Commutator using these files. This is helpful if you
intend to create a custom commutator or adapt an off-shelf-commutator Open Ephys Commutator to your system by reprogramming it to accept
other inputs instead of or in addition to the JSON remote procedure calls (RPCs) that the commutator is already designed
to accept.</p>
</section>
<section id="bill-of-materials-bom">
<h2>Bill of Materials (BoM)<a class="headerlink" href="#bill-of-materials-bom" title="Permalink to this headline">#</a></h2>
<p>BoMs contain references to specific vendors solely to calculate a total price; Open Ephys is not affiliated with
any of them.</p>
<p>The BoM for the mechanical components is provided below.</p>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>post mechanical BoM here. Also provide link to a a google sheet or a spreadsheet in a repo?</p>
</div>
<p>The BoM for the electrical components is provided below.</p>
<div class="admonition-todo admonition" id="id2">
<p class="admonition-title">Todo</p>
<p>post electrical BoM here. Also provide link to a a google sheet or a spreadsheet in a repo?</p>
</div>
</section>
<section id="ordering-and-manufacturing-parts">
<h2>Ordering and Manufacturing Parts<a class="headerlink" href="#ordering-and-manufacturing-parts" title="Permalink to this headline">#</a></h2>
<p>The following sections describe how to fabricate the parts that comprise the Coaxial Commutator</p>
<section id="mechanical">
<h3>Mechanical<a class="headerlink" href="#mechanical" title="Permalink to this headline">#</a></h3>
<p>If you desire low quantity, first seek out local options. Many universities or libraries offer free 3D printing
services. They don’t always have SLS/MJF which is how the commutator enclosures are manufactured, but you might be able to use
a FDM/SLA 3D printing if necessary. The big difference is that you will probably be required to to add structural
supports that assist in the printing process. Post-processing the removal of the structural support can be time-demanding.
If you don’t have access to a SLS/MJF printer and don’t want to
deal with supports, there are many online manufacturers that will 3D print this for you. They cost more and often have a minimum
price to purchase (i.e. <a class="reference external" href="hubs.com">3DHubs</a> has a $90 minimum for those services at the time of writing this) which is not ideal if
you are trying to print a low quantity of pieces. Other popular ones include <a class="reference external" href="formlabs.com">Formlabs</a>,
<a class="reference external" href="shapeways.com">Shapeways</a>, <a class="reference external" href="xometry.com">Xometry</a>, <a class="reference external" href="sculpteo.com">Sculpteo</a> etc. Open Ephys has no affiliation
with any of these companies. Usually to manufacture with the companies, it is required to upload an <a class="reference external" href="https://github.com/open-ephys/onix-commutator/tree/master/mechanical/single_channel/stl">STL</a> or STEP file,
but they are starting now to accommodate other file types as well such as sldprt files.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In creating your own custom commutator, it is possible to change the gear ratio while making minimal changes
the commutator electronics and <a class="reference external" href="https://github.com/open-ephys/onix-commutator/tree/master/firmware/commutator">firmware</a>.
The only change that must be made is a modification of the GEAR_RATIO macro on line 22</p>
</div>
</section>
<section id="electrical">
<h3>Electrical<a class="headerlink" href="#electrical" title="Permalink to this headline">#</a></h3>
<p>Printed circuit boards (PCBs) are boards that electrically connect a set of electronics components to create functional circuits.
Those parts are soldered to the PCB to create mechanically stable and reliable operation. The commutator front panel
is an example of a PCB. If you were to make a own commutator that utilizes a similar type front panel, you will likely
be required to purchase fabrication from another company. Thankfully, PCBs are pretty cheap to fabricate nowadays.
You no longer have to order in bulk to get them relatively cheap. For instance,
You can get a 5-pack of PCBs from <a class="reference external" href="jlcpcb.com">JLCPCB</a> for less than $5. To fabricate a PCB, a manufacturer usually
requires that you upload <a class="reference external" href="https://github.com/open-ephys/onix-commutator/tree/master/control-board/gerber">Gerber files</a>.
To create a PCB (or modify the one used as the front panel of the Open Ephys Commutator), ECAD software such as <a class="reference external" href="https://www.kicad.org/">KiCad</a> is used.
There is other ECAD software available, but KiCad is strongly encouraged as it is open-source, extensible, undergoing constant
improvement, and most importantly easy-to-use. Gerbers can be produced in CAD software after the design is finalized.
Teaching such software is beyond the scope of this guide, but you can find
<a class="reference external" href="https://www.kicad.org/help/learning-resources/">tutorials on KiCad’s website</a> and elsewhere on the web.</p>
<p>For ordering the electronics parts that are mounted onto the PCB, <a class="reference external" href="digikey.com">Digikey</a>, <a class="reference external" href="mouser.com">Mouser</a>, and <a class="reference external" href="arrow.com">Arrow</a> are go-to vendors.
Open Ephys has no affiliation with any of these companies. Some parts may be out-of-stock in which case you are forced to
purchase from more than one distributor if you inflexible regarding component selection. <a class="reference external" href="octopart.com">Octopart</a> is
helpful for sorting through stock at various vendors and comparing prices. The electrical components for the commutator
PCB are mounted (and electrically connected) through solder joints. Soldering instructions are beyond the scope of this
developer guide but there are several <a class="reference external" href="https://www.youtube.com/results?search_query=how+to+solder+pcb">great guides on YouTube</a>.
You can also get them pre-assembled by PCB assemblers. Some PCB fabricators will also assemble the PCBs like JLCPCB.</p>
</section>
</section>
<section id="teensy-and-programming-an-open-ephys-commutator">
<h2>Teensy and Programming an Open Ephys Commutator<a class="headerlink" href="#teensy-and-programming-an-open-ephys-commutator" title="Permalink to this headline">#</a></h2>
<p>Commutator firmware can be uploaded to the device using the <a class="reference external" href="https://www.arduino.cc/en/Main/Software">Arduino IDE</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You will need to add the <a class="reference external" href="https://www.pjrc.com/teensy/teensyduino.html">Teensyduino add-on</a> to the Arduino IDE to program
the Teensy inside the commutator. When installing Teensyduino, you should opt to install the
bundled libraries as well. This takes care of installing <code class="code docutils literal notranslate"><span class="pre">AccelStepper</span></code>
library rather than having to install it manually. ArduinoJSON can be
installed through the Arduino IDE’s package manager.</p>
</div>
<p>It runs on a <a class="reference external" href="https://www.pjrc.com/store/teensy32.html">Teensy
3.2</a>. To compile this firmware and
program the microcontroller, the following dependencies are required:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.arduino.cc/en/Main/Software">Arduino IDE</a></p></li>
<li><p><a class="reference external" href="https://www.pjrc.com/teensy/td_download.html">Teensyduino add-on</a></p></li>
<li><p><a class="reference external" href="https://www.airspayce.com/mikem/arduino/AccelStepper/">AccelStepper</a></p></li>
<li><p><a class="reference external" href="https://arduinojson.org/">Arduino JSON</a></p></li>
</ul>
<p>The Teensy is a microcontroller development board (much like the Arduino for those who are familiar). It is the brains
of the commutator. To directly  control the commutator via computer, it helps to learn to interface with the Teensy. To do that:</p>
<ol class="arabic simple">
<li><p>Download the <a class="reference external" href="https://www.arduino.cc/en/software">Arduino IDE</a></p></li>
<li><p>Install the Arduino IDE’s Teensy plugin, <a class="reference external" href="https://www.pjrc.com/teensy/td_download.html">Teensyduino</a></p></li>
<li><p>Install relevant <a class="reference external" href="https://docs.arduino.cc/software/ide-v2/tutorials/ide-v2-installing-a-library">Arduino libraries</a>: <em>AccelStepper</em> and <em>Arduino JSON</em></p></li>
<li><p>Open the <a class="reference external" href="https://docs.arduino.cc/software/ide-v2/tutorials/ide-v2-serial-monitor">Arduino IDE’s serial monitor</a></p></li>
<li><p>Set correct COM port to which the Teensy is connected and set the serial monitor baud rate to 9600</p></li>
<li><p>Send a command to the commutator according to the communication below.</p></li>
</ol>
<p>The serial monitor displays messages between the commutator and the computer to which the commutator is connected. To send
RPCs to the commutator through the serial monitor, type in the Arduino IDE’s Serial Monitor input field. The commutator’s Teensy is pre-programmed to receive
specific RPCs in the JSON format. Refer to the <a class="reference internal" href="../user-guide/remote-control.html#remote-control"><span class="std std-ref">Remote Control</span></a> page of the User Guide for more information on that. Other serial
monitors can be used (see <a class="reference external" href="https://www.compuphase.com/software_termite.htm">Termite</a> for instance), but these
instructions recommend the Arduino IDE because the Arduino IDE is already quite common in the open-source and science community.
It also allows the user to program the Teensy in a convenient way if that is desired. Its firmware can be modified to accept other RPCs or inputs.</p>
<p>This is the <a class="reference external" href="https://github.com/open-ephys/onix-commutator/tree/master/firmware/commutator">firmware with which the commutator ships</a>.</p>
</section>
<section id="assembly">
<h2>Assembly<a class="headerlink" href="#assembly" title="Permalink to this headline">#</a></h2>
<p>After the PCB is finished being soldered, assembly is pretty straight forward. The stepper motor is inserted and fastened by
four M2.5 screws. The SMA rotary joint is inserted and fastened by M3 or #4-40 screws. The stepper motor connects to a
4-pin connector on the one of the commutator PCB’s daughter boards. The commutator PCB is fastened to the enclosure with
#2-56 screws. The most trickiest part is gluing the gears. They are glued to the motor and rotary joint rotors. Clamp
to ensure the gears do not mis-align during the curing process.</p>
<div class="admonition-todo admonition" id="id3">
<p class="admonition-title">Todo</p>
<p>are #2-56 actually the screws used for fastening PCB to enclosure? Metric equivalent? What glue is used?</p>
</div>
<div class="toctree-wrapper compound">
</div>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../user-guide/troubleshooting.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Troubleshooting</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../../spi-commutator/index.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">SPI Commutator</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2010-2023, Open Ephys &amp; Contributors.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>